```java
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;  
import com.baomidou.mybatisplus.extension.plugins.inner.OptimisticLockerInnerInterceptor;  
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;  
  
public class MPconfig {  
    public MybatisPlusInterceptor mybatisPlusInterceptor(){  
        MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor();  
//        分页插件，乐观锁  
        mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor());  
        mybatisPlusInterceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());  
        return mybatisPlusInterceptor;  
    }  
}
```



MyBatis-Plus 的拦截器机制非常强大，它通过在 SQL 执行过程中进行拦截和干预，实现了许多核心功能。简单来说，​**​你不需要在“添加 SQL 语句”时手动关联拦截器，而是在配置好拦截器后，它会在后台自动对特定类型的 SQL 操作生效。​**​

为了让你快速了解核心场景，下表总结了最常见的需要配置拦截器的操作：

|操作场景|拦截器作用|MyBatis-Plus 提供的拦截器|是否必需|
|---|---|---|---|
|​**​分页查询​**​|自动将查询转换为 `COUNT`语句和带 `LIMIT`的分页查询|`PaginationInnerInterceptor`|​**​是​**​，这是实现分页的核心|
|​**​数据权限控制​**​|在 SQL 的 `WHERE`条件中动态追加限制条件（如“只能查看本人数据”）|需自定义，实现 `InnerInterceptor`接口|否，按业务需求|
|​**​性能监控/SQL 分析​**​|记录 SQL 执行时间、分析慢查询|需自定义|否，按运维需求|
|​**​多租户数据隔离​**​|自动在所有查询中注入租户 ID 条件|`TenantLineInnerInterceptor`|否，按架构需求|
|​**​动态表名​**​|根据逻辑动态改变 SQL 中的表名|需自定义|否，按业务需求|

下面我们来详细看看其中最常用和重要的两种场景。

### 🔧 分页查询：最核心的拦截器应用

当你进行分页查询时，MyBatis-Plus 的 ​**​`PaginationInnerInterceptor`​**​ 拦截器是​**​必须配置​**​的。它的工作原理是：

1. 拦截你执行的查询方法（如 `selectPage`）。
    
2. 自动为你生成并执行一条查询总记录数的 `COUNT`语句。
    
3. 将你的原始查询语句改写为数据库方言特定的分页语句（如 MySQL 的 `LIMIT`，Oracle 的 `ROWNUM`）。
    

​**​配置示例：​**​

你需要在一个配置类中，将分页拦截器添加到 `MybatisPlusInterceptor`中。

```
@Configuration
public class MybatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // 添加分页拦截器是分页功能生效的关键
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); // 根据你的数据库类型选择
        return interceptor;
    }
}
```

配置后，你就可以使用 `Page`对象和 `selectPage`方法进行分页查询了，拦截器会在背后自动处理所有复杂的分页逻辑 。

### 🛡️ 数据权限控制：常见的自定义拦截器场景

这是一个非常实用的高级功能。其目的是根据当前用户的角色，在 SQL 执行前自动在 `WHERE`条件中追加数据过滤条件，例如：

- ​**​普通用户​**​：只能查询到 `creator_id = 当前用户ID`的数据。
    
- ​**​部门经理​**​：可以查询到 `dept_id = 当前部门ID`的数据。
    
- ​**​系统管理员​**​：可以查询所有数据。
    

实现此功能通常需要以下步骤 ：

1. ​**​创建自定义注解​**​（如 `@DataPermission`）：标记在 Mapper 接口的方法上，声明此方法需要数据权限控制。
    
2. ​**​实现自定义拦截器​**​：继承 `JsqlParserSupport`并实现 `InnerInterceptor`接口。在 `beforeQuery`等方法中，解析原始 SQL，并根据注解和用户信息，使用 JSqlParser 工具动态拼接新的 `WHERE`条件。
    
3. ​**​注册拦截器​**​：将自定义的数据权限拦截器添加到 `MybatisPlusInterceptor`中。
    

### 💡 其他需要拦截器的场景

除了上述两种，在以下情况下也可能需要考虑使用拦截器：

- ​**​性能监控与SQL分析​**​：你可以编写拦截器来记录每条 SQL 的执行时间，用于排查慢查询和性能瓶颈 。
    
- ​**​自动填充通用字段​**​：类似于 MyBatis-Plus 的 `@TableField(fill = FieldFill.INSERT)`功能，其底层也是通过拦截器实现的，在插入或更新前自动为特定字段（如 `create_time`, `update_time`）赋值。
    
- ​**​SQL 日志格式化​**​：拦截执行的 SQL 语句，将其格式化成更易读的形式后再输出到日志。
    

### 💎 总结：如何判断是否需要拦截器？

你可以记住一个简单的原则：

> ​**​当你需要自动化、全局性地改变或增强 SQL 的执行行为时，就要考虑使用拦截器。​**​

对于 MyBatis-Plus 的内置功能（如​**​分页​**​），使用相应的内置拦截器是​**​必需​**​的。对于业务特定的逻辑（如​**​数据权限​**​），则需要你​**​自定义​**​拦截器来实现。

希望这个解释能帮助你更好地理解 MyBatis-Plus 拦截器的应用场景！如果你对数据权限或分页拦截器的具体实现细节有进一步兴趣，我们可以继续深入探讨。