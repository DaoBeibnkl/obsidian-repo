docker commit

docker save

docker load

### 📊 ​**​命令功能对比表​**​

|命令|作用|输入|输出|典型场景|
|---|---|---|---|---|
|​**​`docker commit`​**​|将​**​运行中的容器​**​保存为​**​新镜像​**​|容器（动态状态）|镜像（静态）|保存调试后的容器状态|
|​**​`docker save`​**​|将​**​本地镜像​**​打包为​**​压缩文件​**​|镜像（本地仓库）|`.tar`文件|镜像迁移/离线分发|
|​**​`docker load`​**​|将​**​压缩文件​**​导入为​**​本地镜像​**​|`.tar`文件|镜像（本地仓库）|恢复导出的镜像|

---

### 🛠️ ​**​具体操作指南​**​

#### 1. `docker commit`：容器 → 镜像

​**​适用场景​**​：保存容器当前状态（如调试后的环境）

```
# 语法
docker commit [容器名/ID] [新镜像名]:[标签]

# 示例：将容器 "my-app" 保存为镜像 "debug-image:v1"
docker commit my-app debug-image:v1

# 验证
docker images | grep debug-image
```

​**​输出效果​**​：

```
REPOSITORY     TAG    IMAGE ID      SIZE
debug-image    v1     a1b2c3d4e5f6  1.2GB
```

#### 2. `docker save`：镜像 → 压缩文件

​**​适用场景​**​：备份镜像或迁移到其他机器

```
# 语法
docker save -o [输出文件名.tar] [镜像名]:[标签]

# 示例：将镜像 "nginx:alpine" 打包为 nginx-backup.tar
docker save -o nginx-backup.tar nginx:alpine

# 查看生成的文件
ls -lh nginx-backup.tar
```

​**​输出效果​**​：

```
-rw-r--r-- 1 user  group  35M Sep 1 10:00 nginx-backup.tar
```

#### 3. `docker load`：压缩文件 → 镜像

​**​适用场景​**​：恢复备份的镜像

```
# 语法
docker load -i [输入文件名.tar]

# 示例：从 backup.tar 恢复镜像
docker load -i nginx-backup.tar

# 验证
docker images | grep nginx
```

​**​输出效果​**​：

```
nginx    alpine    sha256:...    35MB
```


### ⚠️ ​**​关键注意事项​**​

1. ​**​`commit`的局限性​**​
    
    保存的镜像包含​**​所有容器层​**​（包括临时文件），可能导致镜像臃肿。生产环境建议用 `Dockerfile`重建镜像。
    
2. ​**​`save`vs `export`区别​**​
    
    - `docker save`：保存​**​完整镜像​**​（含多层元数据）
        
    - `docker export`：导出​**​容器文件系统​**​（单层，丢失历史）
        
    
3. ​**​多镜像打包技巧​**​
    
    一次性打包多个镜像：
    
    ```
    docker save -o all-images.tar \
      nginx:alpine \
      redis:latest \
      postgres:13
    ```
    
4. ​**​加载后的镜像名​**​
    
    `docker load`会​**​保留原始镜像名称和标签​**​。如需重命名：
    
    ```
    docker tag sha256:old-id new-name:tag
    ```
    

---

### 💡 ​**​典型场景用例​**​

#### 场景 1：快速保存调试环境

```
# 在容器中安装调试工具后保存
docker exec -it app-container apt install gdb
docker commit app-container debug-env:v1
```

#### 场景 2：离线环境部署

```
# 在可联网机器上
docker pull nginx:alpine
docker save -o nginx.tar nginx:alpine

# 复制到离线服务器
scp nginx.tar user@offline-server:/tmp/

# 在离线服务器上
docker load -i /tmp/nginx.tar
```

#### 场景 3：镜像版本备份

```
# 每月备份一次生产镜像
docker save -o backup-$(date +%Y%m%d).tar \
  my-app:prod \
  mysql:8.0
```

---

掌握这三个命令的组合使用，能高效完成镜像的保存、迁移和恢复操作。