docker commit

docker save

docker load

### ğŸ“Š â€‹**â€‹å‘½ä»¤åŠŸèƒ½å¯¹æ¯”è¡¨â€‹**â€‹

|å‘½ä»¤|ä½œç”¨|è¾“å…¥|è¾“å‡º|å…¸å‹åœºæ™¯|
|---|---|---|---|---|
|â€‹**â€‹`docker commit`â€‹**â€‹|å°†â€‹**â€‹è¿è¡Œä¸­çš„å®¹å™¨â€‹**â€‹ä¿å­˜ä¸ºâ€‹**â€‹æ–°é•œåƒâ€‹**â€‹|å®¹å™¨ï¼ˆåŠ¨æ€çŠ¶æ€ï¼‰|é•œåƒï¼ˆé™æ€ï¼‰|ä¿å­˜è°ƒè¯•åçš„å®¹å™¨çŠ¶æ€|
|â€‹**â€‹`docker save`â€‹**â€‹|å°†â€‹**â€‹æœ¬åœ°é•œåƒâ€‹**â€‹æ‰“åŒ…ä¸ºâ€‹**â€‹å‹ç¼©æ–‡ä»¶â€‹**â€‹|é•œåƒï¼ˆæœ¬åœ°ä»“åº“ï¼‰|`.tar`æ–‡ä»¶|é•œåƒè¿ç§»/ç¦»çº¿åˆ†å‘|
|â€‹**â€‹`docker load`â€‹**â€‹|å°†â€‹**â€‹å‹ç¼©æ–‡ä»¶â€‹**â€‹å¯¼å…¥ä¸ºâ€‹**â€‹æœ¬åœ°é•œåƒâ€‹**â€‹|`.tar`æ–‡ä»¶|é•œåƒï¼ˆæœ¬åœ°ä»“åº“ï¼‰|æ¢å¤å¯¼å‡ºçš„é•œåƒ|

---

### ğŸ› ï¸ â€‹**â€‹å…·ä½“æ“ä½œæŒ‡å—â€‹**â€‹

#### 1. `docker commit`ï¼šå®¹å™¨ â†’ é•œåƒ

â€‹**â€‹é€‚ç”¨åœºæ™¯â€‹**â€‹ï¼šä¿å­˜å®¹å™¨å½“å‰çŠ¶æ€ï¼ˆå¦‚è°ƒè¯•åçš„ç¯å¢ƒï¼‰

```
# è¯­æ³•
docker commit [å®¹å™¨å/ID] [æ–°é•œåƒå]:[æ ‡ç­¾]

# ç¤ºä¾‹ï¼šå°†å®¹å™¨ "my-app" ä¿å­˜ä¸ºé•œåƒ "debug-image:v1"
docker commit my-app debug-image:v1

# éªŒè¯
docker images | grep debug-image
```

â€‹**â€‹è¾“å‡ºæ•ˆæœâ€‹**â€‹ï¼š

```
REPOSITORY     TAG    IMAGE ID      SIZE
debug-image    v1     a1b2c3d4e5f6  1.2GB
```

#### 2. `docker save`ï¼šé•œåƒ â†’ å‹ç¼©æ–‡ä»¶

â€‹**â€‹é€‚ç”¨åœºæ™¯â€‹**â€‹ï¼šå¤‡ä»½é•œåƒæˆ–è¿ç§»åˆ°å…¶ä»–æœºå™¨

```
# è¯­æ³•
docker save -o [è¾“å‡ºæ–‡ä»¶å.tar] [é•œåƒå]:[æ ‡ç­¾]

# ç¤ºä¾‹ï¼šå°†é•œåƒ "nginx:alpine" æ‰“åŒ…ä¸º nginx-backup.tar
docker save -o nginx-backup.tar nginx:alpine

# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls -lh nginx-backup.tar
```

â€‹**â€‹è¾“å‡ºæ•ˆæœâ€‹**â€‹ï¼š

```
-rw-r--r-- 1 user  group  35M Sep 1 10:00 nginx-backup.tar
```

#### 3. `docker load`ï¼šå‹ç¼©æ–‡ä»¶ â†’ é•œåƒ

â€‹**â€‹é€‚ç”¨åœºæ™¯â€‹**â€‹ï¼šæ¢å¤å¤‡ä»½çš„é•œåƒ

```
# è¯­æ³•
docker load -i [è¾“å…¥æ–‡ä»¶å.tar]

# ç¤ºä¾‹ï¼šä» backup.tar æ¢å¤é•œåƒ
docker load -i nginx-backup.tar

# éªŒè¯
docker images | grep nginx
```

â€‹**â€‹è¾“å‡ºæ•ˆæœâ€‹**â€‹ï¼š

```
nginx    alpine    sha256:...    35MB
```


### âš ï¸ â€‹**â€‹å…³é”®æ³¨æ„äº‹é¡¹â€‹**â€‹

1. â€‹**â€‹`commit`çš„å±€é™æ€§â€‹**â€‹
    
    ä¿å­˜çš„é•œåƒåŒ…å«â€‹**â€‹æ‰€æœ‰å®¹å™¨å±‚â€‹**â€‹ï¼ˆåŒ…æ‹¬ä¸´æ—¶æ–‡ä»¶ï¼‰ï¼Œå¯èƒ½å¯¼è‡´é•œåƒè‡ƒè‚¿ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨ `Dockerfile`é‡å»ºé•œåƒã€‚
    
2. â€‹**â€‹`save`vs `export`åŒºåˆ«â€‹**â€‹
    
    - `docker save`ï¼šä¿å­˜â€‹**â€‹å®Œæ•´é•œåƒâ€‹**â€‹ï¼ˆå«å¤šå±‚å…ƒæ•°æ®ï¼‰
        
    - `docker export`ï¼šå¯¼å‡ºâ€‹**â€‹å®¹å™¨æ–‡ä»¶ç³»ç»Ÿâ€‹**â€‹ï¼ˆå•å±‚ï¼Œä¸¢å¤±å†å²ï¼‰
        
    
3. â€‹**â€‹å¤šé•œåƒæ‰“åŒ…æŠ€å·§â€‹**â€‹
    
    ä¸€æ¬¡æ€§æ‰“åŒ…å¤šä¸ªé•œåƒï¼š
    
    ```
    docker save -o all-images.tar \
      nginx:alpine \
      redis:latest \
      postgres:13
    ```
    
4. â€‹**â€‹åŠ è½½åçš„é•œåƒåâ€‹**â€‹
    
    `docker load`ä¼šâ€‹**â€‹ä¿ç•™åŸå§‹é•œåƒåç§°å’Œæ ‡ç­¾â€‹**â€‹ã€‚å¦‚éœ€é‡å‘½åï¼š
    
    ```
    docker tag sha256:old-id new-name:tag
    ```
    

---

### ğŸ’¡ â€‹**â€‹å…¸å‹åœºæ™¯ç”¨ä¾‹â€‹**â€‹

#### åœºæ™¯ 1ï¼šå¿«é€Ÿä¿å­˜è°ƒè¯•ç¯å¢ƒ

```
# åœ¨å®¹å™¨ä¸­å®‰è£…è°ƒè¯•å·¥å…·åä¿å­˜
docker exec -it app-container apt install gdb
docker commit app-container debug-env:v1
```

#### åœºæ™¯ 2ï¼šç¦»çº¿ç¯å¢ƒéƒ¨ç½²

```
# åœ¨å¯è”ç½‘æœºå™¨ä¸Š
docker pull nginx:alpine
docker save -o nginx.tar nginx:alpine

# å¤åˆ¶åˆ°ç¦»çº¿æœåŠ¡å™¨
scp nginx.tar user@offline-server:/tmp/

# åœ¨ç¦»çº¿æœåŠ¡å™¨ä¸Š
docker load -i /tmp/nginx.tar
```

#### åœºæ™¯ 3ï¼šé•œåƒç‰ˆæœ¬å¤‡ä»½

```
# æ¯æœˆå¤‡ä»½ä¸€æ¬¡ç”Ÿäº§é•œåƒ
docker save -o backup-$(date +%Y%m%d).tar \
  my-app:prod \
  mysql:8.0
```

---

æŒæ¡è¿™ä¸‰ä¸ªå‘½ä»¤çš„ç»„åˆä½¿ç”¨ï¼Œèƒ½é«˜æ•ˆå®Œæˆé•œåƒçš„ä¿å­˜ã€è¿ç§»å’Œæ¢å¤æ“ä½œã€‚